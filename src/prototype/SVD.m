clear; close all; clc;

function [B1, G] = oneiter(B, k)
  [c, s] = givens(B(k, k), B(k, k+1));
  B1 = B;
  G = [c s; -s c];
  B1(:, k:k+1) = B1(:, k:k+1) * G'

  [c, s] = givens(B1(k, k), B1(k+1, k));
  G = [c s; -s c];
  B1(k:k+1, :) = G * B1(k:k+1, :)
end

B0 = [
      0.538516  3.145988 0.000000 0.000000 -0.000000 ;
      0.000000  0.700351 1.822189 0.000000 -0.000000 ;
     -0.000000 -0.000000 0.806397 0.040211  0.000000 ;
];

B1 = [
       0.538516  3.145988 0.000000 ;
       0.000000  0.700351 1.822189 ;
      -0.000000 -0.000000 0.806397 ;
];

Bout = B0;
Bout = [B0 ; [0 0 0 0 0]];
n = 4;
m = 20;
for i = 1:m
  for k = 1:n-1
    [Bout, G] = oneiter(Bout, k);
  end
end
